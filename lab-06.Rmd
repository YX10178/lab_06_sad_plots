---
title: "Lab 06 - Ugly charts and Simpson's paradox"
author: "Yuxin"
date: "2/17/25"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox)
library(mosaicData) 
staff <- read_csv("data/instructional-staff.csv")
##Each row in this dataset represents a faculty type, and the columns are the years for which we have data. The values are percentage of hires of that type of faculty for each year.
```

```{r perform the conversion from wide to long format}
staff_long <- staff %>%
  pivot_longer(cols = -faculty_type, names_to = "year") %>%
  mutate(value = as.numeric(value))

staff_long
```
```{r a line graph}
staff_long %>%
  ggplot(aes(x = year, y = value, color = faculty_type)) +
  geom_line()

## `geom_line()`: Each group consists of only one observation.
## â„¹ Do you need to adjust the group aesthetic?
## To address this, we can use the group aesthetic in the following code.
```
### Exercise 1
```{r group, then a line graph}
staff_long %>%
  ggplot(aes(
    x = year,
    y = value,
    group = faculty_type,
    color = faculty_type
  )) +
  geom_line() + labs (
    title = "Faculty Trends Over Time", x = "Year", y = "Percentage of Hires") +   theme_minimal()
```



### Exercise 2
```{r}
## Suppose the objective of this plot was to show that the proportion of part-time faculty have gone up over time compared to other instructional staff types.
## the goal is to compare proportions, we should normalize the data so that each year sums to 100%.
staff_long <- staff_long %>%
  group_by(year) %>%
  mutate(proportion = value / sum(value))

staff_long %>%
  group_by(faculty_type) %>%
  ggplot(aes(
    x = year,
    y = proportion,
    fill = faculty_type))+
    geom_bar(stat = "identity", position = "fill")+
    labs(
    title = "Proportion of Part-Time Faculty Over Time",
    x = "Year",
    y = "Proportion of Faculty",
    fill = "Faculty Type"
    ) +
    coord_flip()+
    theme_minimal()

```

### Exercise 3
```{r}
fisheries <- read_csv("data/fisheries.csv")

#(1) in the pie chart, there are too many small categories, hard to tell 
#(2) the color is ugly...
#(3) Combining all countries into one chart makes it messy. only select the top 10 countries to compare would be more clear 


fisheries_long <- fisheries %>%
  pivot_longer(cols = c("capture", "aquaculture"), names_to = "type", values_to = "value")

top_10 <- fisheries %>%
  arrange(desc(total)) %>%
  slice(1:10)

top_10 <- top_10 %>%
  mutate(percentage_capture = capture / sum(capture) * 100)

top_10 <- top_10 %>%
  mutate(percentage_aquaculture = aquaculture / sum(aquaculture) * 100)


ggplot(top_10, aes(x = "", y = "", fill = country)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +  # Convert to pie chart
  geom_text(aes(label = paste0(round(percentage_capture, 1), "%")), 
            position = position_stack(vjust = 0.5)) + #adds percentage labels      inside the chart.
  labs(
    title = "Capture Fisheries - Top 10 Countries",
    fill = "Country"
  ) +
  theme_minimal()+
  theme(axis.text = element_blank(), axis.ticks = element_blank()) # removes x- and y-axis text/ticks.
  

ggplot(top_10, aes(x = "", y = aquaculture, fill = country)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +  # Convert to pie chart
  geom_text(aes(label = paste0(round(percentage_aquaculture, 1), "%")), 
            position = position_stack(vjust = 0.5)) +
  labs(
    title = "Aquaculture - Top 10 Countries",
    fill = "Country"
  ) +
  theme_minimal() +
  theme(axis.text = element_blank(), axis.ticks = element_blank())


```

### Exercise 4
```{r}

```

### Exercise 5
```{r}

```


### Exercise 6
```{r}

```


### Exercise 7
```{r}

```

